{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabayApi.js","../src/js/index.js"],"sourcesContent":["import axios from 'axios';\n\nconst PIXABAY_API_KEY = '41564492-608cbec99b2782b0c7c759bf5';\nconst PIXABAY_BASE_URL = 'https://pixabay.com/api/';\n\nconst pixabayInstance = axios.create({\n  baseURL: PIXABAY_BASE_URL,\n});\n\nexport const fetchImages = (q, page) => {\n  const searchParams = new URLSearchParams({\n    key: PIXABAY_API_KEY,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: 40,\n    page,\n    q,\n  });\n\n  return pixabayInstance.get(`?${searchParams}`);\n}\n","import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nimport { fetchImages } from \"./pixabayApi.js\";\n\niziToast.settings({\n  position: \"topRight\",\n  transitionIn: \"flipInX\",\n  transitionOut: \"flipOutX\",\n  maxWidth: \"250px\",\n});\n\nconst form = document.getElementById(\"search-form\");\nconst gallery = document.querySelector(\".gallery\");\nconst loader = document.querySelector(\".loader\");\n\nconst pageState = {\n  page: 1,\n  searchParams: \"\",\n  isLoading: false,\n  totalItems: 0,\n  showItems: 0,\n  nextPage() {\n    return ++this.page;\n  },\n  resetState() {\n    this.page = 1;\n    this.searchParams = \"\";\n    this.totalItems = 0;\n    this.showItems = 0;\n\n    gallery.textContent = \"\";\n  },\n  updateSearchParams(newParams) {\n    this.searchParams = newParams;\n  },\n  startLoading() {\n    loader.classList.remove('visually-hidden');\n\n    this.isLoading = true;\n  },\n  finishLoading() {\n    loader.classList.add('visually-hidden');\n\n    this.isLoading = false;\n  },\n  addShowItems(itemsCount) {\n    this.showItems += itemsCount;\n  },\n  canShowNextPage() {\n    return this.totalItems > this.showItems;\n  },\n};\n\nconst lightbox = new SimpleLightbox(\".photo_link\");\n\nconst handleError = (error) => {\n  pageState.finishLoading();\n\n  iziToast.error({ message: error.message });\n};\n\nconst drawCards = (data) => {\n  const markup = data.map((\n    {\n      webformatURL,\n      largeImageURL,\n      tags,\n      likes,\n      views,\n      comments,\n      downloads,\n    }) => `\n    <div class=\"photo-card\">\n      <a class=\"photo_link\" href=\"${largeImageURL}\">\n        <img class=\"photo\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n      </a>\n      <div class=\"info\">\n        <div class=\"info-item\">\n          <b>Likes</b>\n          <p>${likes}</p>\n        </div>\n        <div class=\"info-item\">\n          <b>Views</b>\n           <p>${views}</p>\n        </div>\n        <div class=\"info-item\">\n          <b>Comments</b>\n          <p>${comments}</p>\n        </div>\n        <div class=\"info-item\">\n          <b>Downloads</b>\n          <p>${downloads}</p>\n        </div>\n      </div>\n    </div>\n  `).join(\"\");\n\n  pageState.addShowItems(data.length);\n\n  gallery.insertAdjacentHTML(\"beforeend\", markup);\n\n  lightbox.refresh();\n}\n\nconst handleSubmit = async (event) => {\n  event.preventDefault();\n\n  pageState.resetState();\n\n  const searchValue = event.target.elements.searchQuery.value.trim();\n\n  if (!searchValue) {\n    form.reset();\n\n    iziToast.warning({\n      message: \"Text is required for search images\",\n    });\n\n    return;\n  }\n\n  pageState.updateSearchParams(searchValue);\n  pageState.startLoading();\n\n  try {\n    const response = await fetchImages(pageState.searchParams, pageState.page);\n    const imageData = response.data;\n\n    pageState.totalItems = imageData.totalHits;\n\n    if (!pageState.totalItems) {\n      iziToast.warning({\n        message: \"Sorry, there are no images matching your search query. Please try again.\",\n      });\n    } else {\n      iziToast.success({\n        message: `Hooray! We found ${pageState.totalItems} images.`,\n      });\n    }\n\n    drawCards(imageData.hits);\n\n    pageState.finishLoading();\n\n    window.addEventListener(\"scroll\", handleScroll);\n  } catch (error) {\n    handleError(error);\n  }\n};\n\nconst handleScroll = async () => {\n  const isBottomOfPage = window.scrollY + window.innerHeight >=\n    document.documentElement.scrollHeight;\n\n  if (!(isBottomOfPage && !pageState.isLoading)) {\n    return;\n  }\n\n  if (!pageState.canShowNextPage()) {\n    window.removeEventListener(\"scroll\", handleScroll);\n\n    gallery.insertAdjacentHTML(\n      \"beforeend\",\n      \"<p>We're sorry, but you've reached the end of search results.</p>\",\n    );\n\n    return;\n  }\n\n  pageState.startLoading();\n\n  try {\n    const response = await fetchImages(\n      pageState.searchParams,\n      pageState.nextPage(),\n    );\n\n    drawCards(response.data.hits);\n\n    pageState.finishLoading();\n\n    const { height: cardHeight } = gallery\n      .firstElementChild\n      .getBoundingClientRect();\n\n    window.scrollBy({ top: cardHeight * 1.5, behavior: \"smooth\" });\n  } catch (error) {\n    handleError(error);\n  }\n};\n\nform.addEventListener(\"submit\", handleSubmit);\n"],"names":["PIXABAY_API_KEY","PIXABAY_BASE_URL","pixabayInstance","axios","fetchImages","q","page","searchParams","iziToast","form","gallery","loader","pageState","newParams","itemsCount","lightbox","SimpleLightbox","handleError","error","drawCards","data","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","handleSubmit","event","searchValue","imageData","handleScroll","response","cardHeight"],"mappings":"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"}